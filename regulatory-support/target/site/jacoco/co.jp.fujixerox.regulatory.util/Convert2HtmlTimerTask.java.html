<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Convert2HtmlTimerTask.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">regulatory-support</a> &gt; <a href="index.html" class="el_package">co.jp.fujixerox.regulatory.util</a> &gt; <span class="el_source">Convert2HtmlTimerTask.java</span></div><h1>Convert2HtmlTimerTask.java</h1><pre class="source lang-java linenums">package co.jp.fujixerox.regulatory.util;

import java.io.File;
import java.io.InputStream;
import java.util.List;
import java.util.Properties;
import java.util.TimerTask;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

public class Convert2HtmlTimerTask extends TimerTask {

<span class="fc" id="L14">	private static Logger logger = LogManager.getLogger(Convert2HtmlTimerTask.class);</span>
<span class="fc" id="L15">	private static boolean isRunning = false;</span>
<span class="fc" id="L16">	private Properties props = null;</span>

<span class="fc" id="L18">	public Convert2HtmlTimerTask() {</span>
		try {
<span class="fc" id="L20">			props = new Properties();</span>
<span class="fc" id="L21">			InputStream in = this.getClass().getClassLoader().getResourceAsStream(&quot;system.properties&quot;);</span>
<span class="fc" id="L22">			props.load(in);</span>
<span class="nc" id="L23">		} catch (Exception e) {</span>
<span class="nc" id="L24">			throw new ExceptionInInitializerError(e);</span>
<span class="fc" id="L25">		}</span>
<span class="fc" id="L26">	}</span>

	public void run() {
		try {
<span class="pc bpc" id="L30" title="1 of 2 branches missed.">			if (!isRunning) {</span>
<span class="fc" id="L31">				isRunning = true;</span>
<span class="fc" id="L32">				logger.info(&quot;バッチ処理開始...&quot;);</span>

				// Pdf入力フォルダー
<span class="fc" id="L35">				String pdfPath = props.getProperty(&quot;batchinput_pdf&quot;);</span>
<span class="fc" id="L36">				String wordPath = props.getProperty(&quot;batchinput_word&quot;);</span>
<span class="fc" id="L37">				String dcuworksPath = props.getProperty(&quot;batchinput_dcuworks&quot;);</span>
<span class="fc" id="L38">				String excelPath = props.getProperty(&quot;batchinput_excel&quot;);</span>
				// pdf2htmlEX ファイルパス
<span class="fc" id="L40">				String exeFilePath = props.getProperty(&quot;toolpath&quot;);</span>
				// DocuWorks2Pdf ツールパス
<span class="fc" id="L42">				String batPath = props.getProperty(&quot;file2pdfBat&quot;);</span>
				// printto.exeパス
<span class="fc" id="L44">				String printtoPath = props.getProperty(&quot;printtoPath&quot;);</span>

				// フォルダーが存在しないの場合
<span class="fc" id="L47">				SystemUtil.isExist(pdfPath, null);</span>
<span class="fc" id="L48">				SystemUtil.isExist(wordPath, null);</span>
<span class="fc" id="L49">				SystemUtil.isExist(dcuworksPath, null);</span>
<span class="fc" id="L50">				SystemUtil.isExist(excelPath, null);</span>

				// Pdfファイルリスト
<span class="fc" id="L53">				List&lt;String&gt; pdfFileList = SystemUtil.getAllFiles(pdfPath);</span>
<span class="fc" id="L54">				boolean pdfDeleteFlg = false;</span>
<span class="pc bpc" id="L55" title="1 of 2 branches missed.">				if (pdfFileList.size() == 0) {</span>
<span class="nc" id="L56">					logger.info(&quot;変換するのPDFファイルが見つかりません。&quot;);</span>
				} else {
<span class="fc bfc" id="L58" title="All 2 branches covered.">					for (String pdfFilePath : pdfFileList) {</span>
						// Pdfファイル名
<span class="fc" id="L60">						String pdflFileName = pdfFilePath.substring(pdfFilePath.lastIndexOf(&quot;\\&quot;) + 1);</span>
						// HTMLファイル名
<span class="fc" id="L62">						String htmlFileName = pdflFileName.substring(0, pdflFileName.lastIndexOf(&quot;.&quot;));</span>
						// 拡張子
<span class="fc" id="L64">						String type = pdfFilePath.substring(pdfFilePath.lastIndexOf(&quot;.&quot;) + 1, pdfFilePath.length())</span>
<span class="fc" id="L65">								.toLowerCase();</span>
						// システム日時
<span class="fc" id="L67">						String sysDate = SystemUtil.getSystemDate();</span>
						// 出力パス
<span class="fc" id="L69">						String outputPath = props.getProperty(&quot;pdf2htmloutput&quot;) + File.separator + sysDate;</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">						if (&quot;pdf&quot;.equals(type)) {</span>
<span class="fc" id="L71">							pdfDeleteFlg = Pdf2HtmlUtil.convertToHtmlEX(exeFilePath, pdfFilePath, outputPath,</span>
									htmlFileName);
							// 入力Pdfファイルの削除
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">							if (pdfDeleteFlg) {</span>
<span class="nc" id="L75">								SystemUtil.deleteFile(pdfFilePath);</span>
							}
						}
<span class="fc" id="L78">					}</span>
				}

				// wordファイルリスト
<span class="fc" id="L82">				List&lt;String&gt; wordFileList = SystemUtil.getAllFiles(wordPath);</span>
<span class="fc" id="L83">				boolean wordDeleteFlg = false;</span>
<span class="pc bpc" id="L84" title="1 of 2 branches missed.">				if (wordFileList.size() == 0) {</span>
<span class="nc" id="L85">					logger.info(&quot;変換するのWORDファイルが見つかりません。&quot;);</span>
				} else {
<span class="fc bfc" id="L87" title="All 2 branches covered.">					for (String wordFilePath : wordFileList) {</span>
						// Wordファイル名
<span class="fc" id="L89">						String wordFileName = wordFilePath.substring(wordFilePath.lastIndexOf(&quot;\\&quot;) + 1);</span>
						// HTMLファイル名
<span class="fc" id="L91">						String htmlFileName = wordFileName.substring(0, wordFileName.lastIndexOf(&quot;.&quot;));</span>
						// システム日時
<span class="fc" id="L93">						String sysDate = SystemUtil.getSystemDate();</span>
						// 出力パス
<span class="fc" id="L95">						String outputPath = props.getProperty(&quot;word2htmloutput&quot;) + File.separator + sysDate;</span>
						// 拡張子
<span class="fc" id="L97">						String type = wordFilePath.substring(wordFilePath.lastIndexOf(&quot;.&quot;) + 1, wordFilePath.length())</span>
<span class="fc" id="L98">								.toLowerCase();</span>

<span class="pc bpc" id="L100" title="3 of 4 branches missed.">						if (&quot;doc&quot;.equals(type) || &quot;docx&quot;.equals(type)) {</span>
<span class="fc" id="L101">							wordDeleteFlg = JacobUtil.wordToHtml(wordFilePath, outputPath,</span>
									outputPath + File.separator + htmlFileName + &quot;.html&quot;, batPath, printtoPath,
									exeFilePath);
							// 入力Wordファイルの削除
<span class="pc bpc" id="L105" title="1 of 2 branches missed.">							if (wordDeleteFlg) {</span>
<span class="nc" id="L106">								SystemUtil.deleteFile(wordFilePath);</span>
							}
						}
<span class="fc" id="L109">					}</span>
				}
				
				// dcuworksファイルリスト
<span class="fc" id="L113">				List&lt;String&gt; xdwFileList = SystemUtil.getAllFiles(dcuworksPath);</span>
<span class="fc" id="L114">				boolean xdwDeleteFlg = false;</span>
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">				if (xdwFileList.size() == 0) {</span>
<span class="fc" id="L116">					logger.info(&quot;変換するのDcuworksファイルが見つかりません。&quot;);</span>
				} else {
<span class="nc bnc" id="L118" title="All 2 branches missed.">					for (String xdwFilePath : xdwFileList) {</span>
<span class="nc" id="L119">						String type = xdwFilePath.substring(xdwFilePath.lastIndexOf(&quot;.&quot;) + 1,</span>
<span class="nc" id="L120">								xdwFilePath.length()).toLowerCase();</span>
						// PDF出力パス
<span class="nc" id="L122">						String outputPath = props.getProperty(&quot;docuWorks2pdfOutput&quot;);</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">						if (&quot;xdw&quot;.equals(type)) {</span>
							
							// Dcuworksファイル変換
<span class="nc" id="L126">							xdwDeleteFlg = DocuWorksUtil.print(xdwFilePath, batPath, printtoPath, outputPath,</span>
									exeFilePath);
							// 入力xdwファイルの削除
<span class="nc bnc" id="L129" title="All 2 branches missed.">							if (xdwDeleteFlg) {</span>
<span class="nc" id="L130">								SystemUtil.deleteFile(xdwFilePath);</span>
							}
						}
<span class="nc" id="L133">					}</span>
				}
				
				// excelファイルリスト
<span class="fc" id="L137">				List&lt;String&gt; excelFileList = SystemUtil.getAllFiles(excelPath);</span>
<span class="fc" id="L138">				boolean excelDeleteFlg = false;</span>
<span class="fc bfc" id="L139" title="All 2 branches covered.">				if (excelFileList.size() == 0) {</span>
<span class="fc" id="L140">					logger.info(&quot;変換するのExcelファイルが見つかりません。&quot;);</span>
				} else {
<span class="fc bfc" id="L142" title="All 2 branches covered.">					for (String excelFilePath : excelFileList) {</span>
						// Excelファイル名
<span class="fc" id="L144">						String excelFileName = excelFilePath.substring(excelFilePath.lastIndexOf(&quot;\\&quot;) + 1);</span>
						// HTMLファイル名
<span class="fc" id="L146">						String htmlFileName = excelFileName.substring(0, excelFileName.lastIndexOf(&quot;.&quot;));</span>
						// システム日時
<span class="fc" id="L148">						String sysDate = SystemUtil.getSystemDate();</span>
						// 出力パス
<span class="fc" id="L150">						String outputPath = props.getProperty(&quot;excel2htmloutput&quot;) + File.separator + sysDate;</span>
						// 拡張子
<span class="fc" id="L152">						String type = excelFilePath.substring(excelFilePath.lastIndexOf(&quot;.&quot;) + 1, excelFilePath.length())</span>
<span class="fc" id="L153">								.toLowerCase();</span>

<span class="pc bpc" id="L155" title="2 of 4 branches missed.">						if (&quot;xls&quot;.equals(type) || &quot;xlsx&quot;.equals(type)) {</span>
<span class="fc" id="L156">							SystemUtil.isExist(outputPath, null);</span>
<span class="fc" id="L157">							excelDeleteFlg = JacobUtil.excelToHtml(excelFilePath, outputPath + File.separator</span>
									+ htmlFileName + &quot;.html&quot;);
							// 入力Excelファイルの削除
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">							if (excelDeleteFlg) {</span>
<span class="fc" id="L161">								SystemUtil.deleteFile(excelFilePath);</span>
							}
						}
<span class="fc" id="L164">					}</span>
				}
				
<span class="fc" id="L167">				logger.info(&quot;バッチ処理 終了...&quot;);</span>
<span class="fc" id="L168">				isRunning = false;</span>
<span class="fc" id="L169">			} else {</span>
<span class="nc" id="L170">				logger.info(&quot;前回任務は終わっていませんでした。&quot;);</span>
			}
<span class="nc" id="L172">		} catch (Exception e) {</span>
<span class="nc" id="L173">			logger.error(&quot;バッチ処理実行中で例外が発生しました。&quot;, e);</span>
<span class="fc" id="L174">		}</span>
<span class="fc" id="L175">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://jacoco.org">JaCoCo</a> 0.5.3.201107060350</span></div></body></html>